datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model events {
  id                 Int                  @id @default(autoincrement())
  name               String               @default("Unnamed Event")
  description        String?
  published          Boolean              @default(false)
  prices             Json[]
  media              String[]
  thumbnail          String?
  hashtags           String[]
  maxTickets         Int                  @default(0)
  location           String               @default("TBD")
  tickets            tickets[]
  stripeProductId    String?
  snsTopicArn        String?
  startTime          DateTime
  endTime            DateTime
  eventNotifications eventNotifications[]

  hostId Int
  host   hosts @relation(fields: [hostId], references: [id])
}

model eventNotifications {
  id          Int      @id @default(autoincrement())
  messageTime DateTime
  message     String
  eventId     Int
  event       events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  sent        Boolean  @default(false)
}

model users {
  id          String        @id @unique
  email       String        @unique
  name        String?
  roles       String[]      @default(["user"])
  hostRoles   hostRoles[]
  tickets     tickets[]
  userTickets userTickets[]
}

model hosts {
  id          Int         @id @default(autoincrement())
  name        String      @default("Unnamed Host")
  description String?
  events      events[]
  hostRoles   hostRoles[]
}

model hostRoles {
  hostId Int
  host   hosts @relation(fields: [hostId], references: [id])

  userId String
  user   users  @relation(fields: [userId], references: [id])

  role String

  @@id([hostId, userId])
}

model tickets {
  id                  Int           @id @default(autoincrement())
  eventId             Int
  event               events        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  stripeSessionId     String
  stripeChargeId      String
  receiptUrl          String
  customerName        String
  customerPhoneNumber String
  customerEmail       String
  userId              String?
  user                users?        @relation(fields: [userId], references: [id])
  ticketQuantity      Int
  used                Boolean
  purchasedAt         DateTime      @default(now())
  userTickets         userTickets[]
}

model userTickets {
  id       Int     @id @default(autoincrement())
  userId   String
  ticketId Int
  user     users   @relation(fields: [userId], references: [id])
  ticket   tickets @relation(fields: [ticketId], references: [id])
}
